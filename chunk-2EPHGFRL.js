import{A as pe,B as le,C as se,D as ce,E as me,F as de,G as _e,c as Q,i as W,j as X,s as Z,t as ee,u as te,v as ne,w as ie,x as oe,y as ae,z as re}from"./chunk-MU522GSY.js";import{a as A}from"./chunk-ZPEBW7X4.js";import"./chunk-3RTQ72Y6.js";import{t as z}from"./chunk-DCUX3RJ3.js";import"./chunk-OOVJ2RK5.js";import"./chunk-UT6QFC45.js";import"./chunk-VE3YEBPC.js";import"./chunk-57JEQQKW.js";import{a as q,b as J}from"./chunk-GCU5MVPG.js";import{b as N}from"./chunk-GRNZQBTD.js";import{a as L,b as Y}from"./chunk-XCJIMQHN.js";import"./chunk-XOSZVAVX.js";import"./chunk-3UMKY4XX.js";import{Aa as d,Fa as g,Ia as P,Ja as I,Ka as i,La as o,Lb as H,Ma as y,N as M,Na as _,Oa as x,Ob as K,Oc as V,Qa as B,S as E,Sa as S,T as h,Ta as m,Wa as G,_b as j,a as D,b as O,ca as w,db as a,eb as T,fb as f,gb as R,ia as r,ma as v,mb as $,nb as U,ob as b,ra as F,sb as k,wa as s}from"./chunk-OCIATHT5.js";var Ce=e=>["/groups",e],ge=()=>[],ye=(e,t)=>t.id;function Me(e,t){e&1&&(i(0,"th",13),a(1," Opis"),o())}function Ee(e,t){e&1&&(i(0,"mat-icon",16),a(1,"check_circle"),o())}function he(e,t){e&1&&(i(0,"mat-icon",17),a(1,"cancel"),o())}function we(e,t){if(e&1&&(i(0,"td",14)(1,"span",15),a(2),s(3,Ee,2,0,"mat-icon",16)(4,he,2,0,"mat-icon",17),o()()),e&2){let n=t.$implicit;r(2),f(" ",n.description," "),r(),g(n.isPaid?3:4)}}function ve(e,t){e&1&&(i(0,"th",13),a(1,"Kategoria"),o())}function Se(e,t){if(e&1&&(i(0,"span",18)(1,"mat-icon",19),a(2),o(),i(3,"span",20),a(4),o()()),e&2){let n=m().$implicit;r(),d("matTooltip",n.category.mainCategory+" - "+n.category.subCategory),r(),f(" ",n.category.icon," "),r(2),T(n.category.subCategory)}}function Te(e,t){e&1&&(i(0,"span",18)(1,"mat-icon",21),a(2,"category"),o(),i(3,"span",20),a(4,"Og\xF3lne"),o()())}function be(e,t){if(e&1&&(i(0,"td",14),s(1,Se,5,3,"span",18)(2,Te,5,0,"span",18),o()),e&2){let n=t.$implicit;r(),g(n.category?1:2)}}function ke(e,t){e&1&&(i(0,"th",13),a(1," Kwota"),o())}function De(e,t){if(e&1&&(i(0,"td",14),a(1),o()),e&2){let n=t.$implicit;r(),R(" ",n.amount," ",n.currency,"")}}function Oe(e,t){e&1&&(i(0,"th",13),a(1," Data"),o())}function Fe(e,t){if(e&1&&(i(0,"td",14)(1,"span",19),b(2,"date"),a(3),b(4,"date"),o()()),e&2){let n=t.$implicit;r(),G("matTooltip",k(2,2,n.date,"medium","","pl")),r(2),f(" ",k(4,7,n.date,"shortDate","","pl")," ")}}function Pe(e,t){e&1&&(i(0,"th",13),a(1," Akcje"),o())}function Ie(e,t){if(e&1){let n=B();i(0,"td",14)(1,"button",22),S("click",function(){let p=E(n).$implicit,c=m().$implicit,C=m(2);return h(C.editExpense(p,c))}),i(2,"mat-icon"),a(3,"edit"),o()(),i(4,"button",23),S("click",function(){let p=E(n).$implicit,c=m(3);return h(c.deleteExpense(p))}),i(5,"mat-icon"),a(6,"delete"),o()()()}}function Be(e,t){e&1&&y(0,"tr",24)}function Ge(e,t){e&1&&y(0,"tr",25)}function Re(e,t){if(e&1&&(i(0,"h2",0)(1,"a",1),a(2),o()(),i(3,"table",2),_(4,3),s(5,Me,2,0,"th",4)(6,we,5,2,"td",5),x(),_(7,6),s(8,ve,2,0,"th",4)(9,be,3,1,"td",5),x(),_(10,7),s(11,ke,2,0,"th",4)(12,De,2,2,"td",5),x(),_(13,8),s(14,Oe,2,0,"th",4)(15,Fe,5,12,"td",5),x(),_(16,9),s(17,Pe,2,0,"th",4)(18,Ie,7,0,"td",5),x(),s(19,Be,1,0,"tr",10)(20,Ge,1,0,"tr",11),o(),y(21,"mat-divider",12)),e&2){let n,l=t.$implicit,p=m(2);r(),d("routerLink",U(5,Ce,l.id)),r(),f(" ",l.name," "),r(),d("dataSource",(n=p.expensesByGroup().get(l))!==null&&n!==void 0?n:$(7,ge)),r(16),d("matHeaderRowDef",p.columns),r(),d("matRowDefColumns",p.columns)}}function $e(e,t){if(e&1&&P(0,Re,22,8,null,null,ye),e&2){let n=m();I(n.expensesByGroupKeys())}}function Ue(e,t){if(e&1&&(i(0,"p"),a(1),o()),e&2){let n=m();r(),T(n.msg)}}var xe=class e{constructor(t,n){this.snackBar=t;this.dialog=n}currentUserId=0;expensesByGroup=w(new Map);expensesByGroupKeys=w([]);columns=["description","category","amount","date","actions"];msg="\u0141adowanie wydatk\xF3w...";expenseService=M(A);authService=M(N);ngOnInit(){this.currentUserId=this.authService.getLoggedUser()?.id,this.currentUserId?this.loadExpenses():console.warn("ngOnInit: No current user ID found.")}deleteExpense(t){this.dialog.open(ne,{width:"400px"}).afterClosed().subscribe(l=>{l&&this.expenseService.deleteExpense(t.id).subscribe({next:()=>{this.loadExpenses(),this.snackBar.open("Expense deleted successfully","Close",{duration:3e3})},error:p=>{console.error(p),this.snackBar.open("Error deleting expense","Close",{duration:3e3})}})})}editExpense(t,n){this.dialog.open(te,{width:"70%",data:{group:n,expense:t,isEdit:!0}}).afterClosed().subscribe(p=>{p&&this.expenseService.updateExpense(t.id,p).subscribe({next:()=>{this.snackBar.open("Expense updated successfully","Close",{duration:3e3}),this.loadExpenses()},error:c=>{console.error(c),this.snackBar.open("Error updating expense","Close",{duration:3e3})}})})}loadExpenses(){this.expenseService.getExpenseForUser(this.currentUserId).subscribe({next:t=>{let n=new Map,l=[];t&&t.length>0?t.forEach(p=>{let c=p.group,C=p.expenses;if(c&&C){let ue=C.map(u=>{let fe=typeof u.category=="string"?Z(u.category):u.category||ee;return O(D({},u),{date:new Date(u.date),category:fe})});n.set(c,ue),l.push(c)}else this.msg="Nie ma \u017Cadnych wydatk\xF3w \u{1F625}"}):this.msg="Nie ma \u017Cadnych wydatk\xF3w \u{1F625}",this.expensesByGroup.set(n),this.expensesByGroupKeys.set(l)},error:t=>{console.error("Error fetching expenses:",t)}})}static \u0275fac=function(n){return new(n||e)(v(z),v(Q))};static \u0275cmp=F({type:e,selectors:[["app-my-expenses"]],decls:2,vars:1,consts:[[1,"sticky-header"],[1,"group-link",3,"routerLink"],["mat-table","",1,"mat-elevation-z2","expense-table",3,"dataSource"],["matColumnDef","description"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","category"],["matColumnDef","amount"],["matColumnDef","date"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"expense-group-divider"],["mat-header-cell",""],["mat-cell",""],[1,"cell"],["matTooltip","Uregulowane",1,"paid-icon"],["matTooltip","Nieuregulowane",1,"paid-icon"],[1,"cell","category-cell"],[3,"matTooltip"],[1,"category-name"],["matTooltip","Bez kategorii"],["mat-icon-button","","color","primary","matTooltip","Edytuj wydatek",3,"click"],["mat-icon-button","","color","warn","matTooltip","Skasuj wydatek",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(n,l){n&1&&s(0,$e,2,0)(1,Ue,2,1,"p"),n&2&&g(l.expensesByGroupKeys().length>0?0:1)},dependencies:[K,H,_e,ie,ae,se,re,oe,ce,pe,le,me,de,j,Y,L,V,X,W,J,q],styles:[".paid-icon[_ngcontent-%COMP%]{font-size:16px;height:16px;width:16px}.expense-group-divider[_ngcontent-%COMP%]{margin-top:20px;margin-bottom:10px}.cell[_ngcontent-%COMP%]{display:flex;align-items:center;flex-direction:row;gap:5px}.sticky-header[_ngcontent-%COMP%]{position:sticky;top:0;background-color:#fff;z-index:1;padding:5px;font-size:20px;font-weight:700}.group-link[_ngcontent-%COMP%]{text-decoration:none;color:inherit;display:block;width:100%;padding:16px}.group-link[_ngcontent-%COMP%]:hover{color:#1976d2}.expense-table[_ngcontent-%COMP%]{width:100%;table-layout:fixed}.expense-table[_ngcontent-%COMP%]   .mat-column-description[_ngcontent-%COMP%]{flex:1;min-width:150px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.expense-table[_ngcontent-%COMP%]   .mat-column-category[_ngcontent-%COMP%]{width:120px}.category-cell[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.category-name[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:80px}.expense-table[_ngcontent-%COMP%]   .mat-column-amount[_ngcontent-%COMP%]{width:100px;text-align:right}.expense-table[_ngcontent-%COMP%]   .mat-column-date[_ngcontent-%COMP%]{width:120px}.expense-table[_ngcontent-%COMP%]   .mat-column-paid[_ngcontent-%COMP%]{width:80px;text-align:center}.expense-table[_ngcontent-%COMP%]   .mat-column-actions[_ngcontent-%COMP%]{width:140px;text-align:center}"]})};export{xe as MyExpensesComponent};
