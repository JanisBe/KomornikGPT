import{A as re,B as pe,C as se,D as le,E as me,c as Q,i as W,j as X,s as Y,t as Z,u as ee,v as te,w as ne,x as ie,y as oe,z as ae}from"./chunk-Q5L7OG5H.js";import{a as A}from"./chunk-PLEYEYRX.js";import"./chunk-3RTQ72Y6.js";import{t as z}from"./chunk-3SQQUEWW.js";import"./chunk-CBJ5GURM.js";import"./chunk-FIU6Q7JL.js";import"./chunk-Z6R5JC6W.js";import"./chunk-ERPTQ7SM.js";import{a as q,b as J}from"./chunk-WYPXIJJM.js";import{b as K}from"./chunk-E6PGGP4I.js";import{a as N,b as L}from"./chunk-U2HAPIUY.js";import"./chunk-C347TPR5.js";import"./chunk-CLIUXEPF.js";import{Aa as d,Fa as w,Ia as O,Ja as P,Ka as i,Kb as H,La as a,Ma as f,N as g,Na as _,Nb as U,Nc as V,Oa as x,Qa as F,S as M,Sa as v,T as h,Ta as c,Wa as B,Zb as j,a as D,b as T,ca as E,db as r,fb as C,gb as G,ia as s,ma as y,mb as R,nb as $,ob as b,ra as I,sb as S,wa as m}from"./chunk-LRQC4R4T.js";var _e=e=>["/groups",e],xe=()=>[],ue=(e,t)=>t.id;function fe(e,t){e&1&&(i(0,"th",12),r(1," Opis"),a())}function Ce(e,t){e&1&&(i(0,"mat-icon",15),r(1,"check_circle"),a())}function ge(e,t){e&1&&(i(0,"mat-icon",16),r(1,"cancel"),a())}function Me(e,t){if(e&1&&(i(0,"td",13)(1,"span",14),r(2),m(3,Ce,2,0,"mat-icon",15)(4,ge,2,0,"mat-icon",16),a()()),e&2){let n=t.$implicit;s(2),C(" ",n.description," "),s(),w(n.isPaid?3:4)}}function he(e,t){e&1&&(i(0,"th",12),r(1," Kwota"),a())}function Ee(e,t){if(e&1&&(i(0,"td",13),r(1),a()),e&2){let n=t.$implicit;s(),G(" ",n.amount," ",n.currency,"")}}function ye(e,t){e&1&&(i(0,"th",12),r(1," Data"),a())}function we(e,t){if(e&1&&(i(0,"td",13)(1,"span",17),b(2,"date"),r(3),b(4,"date"),a()()),e&2){let n=t.$implicit;s(),B("matTooltip",S(2,2,n.date,"medium","","pl")),s(2),C(" ",S(4,7,n.date,"shortDate","","pl")," ")}}function ve(e,t){e&1&&(i(0,"th",12),r(1," Akcje"),a())}function be(e,t){if(e&1){let n=F();i(0,"td",13)(1,"button",18),v("click",function(){let o=M(n).$implicit,l=c().$implicit,u=c(2);return h(u.editExpense(o,l))}),i(2,"mat-icon"),r(3,"edit"),a()(),i(4,"button",19),v("click",function(){let o=M(n).$implicit,l=c(3);return h(l.deleteExpense(o))}),i(5,"mat-icon"),r(6,"delete"),a()()()}}function Se(e,t){e&1&&f(0,"tr",20)}function ke(e,t){e&1&&f(0,"tr",21)}function De(e,t){if(e&1&&(i(0,"h2",0)(1,"a",1),r(2),a()(),i(3,"table",2),_(4,3),m(5,fe,2,0,"th",4)(6,Me,5,2,"td",5),x(),_(7,6),m(8,he,2,0,"th",4)(9,Ee,2,2,"td",5),x(),_(10,7),m(11,ye,2,0,"th",4)(12,we,5,12,"td",5),x(),_(13,8),m(14,ve,2,0,"th",4)(15,be,7,0,"td",5),x(),m(16,Se,1,0,"tr",9)(17,ke,1,0,"tr",10),a(),f(18,"mat-divider",11)),e&2){let n,p=t.$implicit,o=c(2);s(),d("routerLink",$(5,_e,p.id)),s(),C(" ",p.name," "),s(),d("dataSource",(n=o.expensesByGroup().get(p))!==null&&n!==void 0?n:R(7,xe)),s(13),d("matHeaderRowDef",o.columns),s(),d("matRowDefColumns",o.columns)}}function Te(e,t){if(e&1&&O(0,De,19,8,null,null,ue),e&2){let n=c();P(n.expensesByGroupKeys())}}function Ie(e,t){e&1&&(i(0,"p"),r(1,"\u0141adowanie wydatk\xF3w"),a())}var ce=class e{constructor(t,n){this.snackBar=t;this.dialog=n}currentUserId=0;expensesByGroup=E(new Map);expensesByGroupKeys=E([]);columns=["description","amount","date","actions"];expenseService=g(A);authService=g(K);ngOnInit(){this.currentUserId=this.authService.getLoggedUser()?.id,this.currentUserId?this.loadExpenses():console.warn("ngOnInit: No current user ID found.")}deleteExpense(t){this.dialog.open(Z,{width:"400px"}).afterClosed().subscribe(p=>{p&&this.expenseService.deleteExpense(t.id).subscribe({next:()=>{this.loadExpenses(),this.snackBar.open("Expense deleted successfully","Close",{duration:3e3})},error:o=>{console.error(o),this.snackBar.open("Error deleting expense","Close",{duration:3e3})}})})}editExpense(t,n){this.dialog.open(Y,{width:"70%",data:{group:n,expense:t,isEdit:!0}}).afterClosed().subscribe(o=>{o&&this.expenseService.updateExpense(t.id,o).subscribe({next:()=>{this.snackBar.open("Expense updated successfully","Close",{duration:3e3}),this.loadExpenses()},error:l=>{console.error(l),this.snackBar.open("Error updating expense","Close",{duration:3e3})}})})}loadExpenses(){this.expenseService.getExpenseForUser(this.currentUserId).subscribe({next:t=>{let n=new Map,p=[];t&&t.length>0?t.forEach(o=>{let l=o.group,u=o.expenses;if(l&&u){let de=u.map(k=>T(D({},k),{date:new Date(k.date)}));n.set(l,de),p.push(l)}else console.warn("Item in groupExpensesList is missing group or expenses property:",o)}):console.warn("API returned empty or null groupExpensesList:",t),this.expensesByGroup.set(n),this.expensesByGroupKeys.set(p)},error:t=>{console.error("Error fetching expenses:",t)}})}static \u0275fac=function(n){return new(n||e)(y(z),y(Q))};static \u0275cmp=I({type:e,selectors:[["app-my-expenses"]],decls:2,vars:1,consts:[[1,"sticky-header"],[1,"group-link",3,"routerLink"],["mat-table","",1,"mat-elevation-z2","expense-table",3,"dataSource"],["matColumnDef","description"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","amount"],["matColumnDef","date"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"expense-group-divider"],["mat-header-cell",""],["mat-cell",""],[1,"cell"],["matTooltip","Uregulowane",1,"paid-icon"],["matTooltip","Nieuregulowane",1,"paid-icon"],[3,"matTooltip"],["mat-icon-button","","color","primary","matTooltip","Edytuj wydatek",3,"click"],["mat-icon-button","","color","warn","matTooltip","Skasuj wydatek",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(n,p){n&1&&m(0,Te,2,0)(1,Ie,2,0,"p"),n&2&&w(p.expensesByGroupKeys().length>0?0:1)},dependencies:[U,H,me,ee,ne,re,ie,te,pe,oe,ae,se,le,j,L,N,V,X,W,J,q],styles:[".paid-icon[_ngcontent-%COMP%]{font-size:16px;height:16px;width:16px}.expense-group-divider[_ngcontent-%COMP%]{margin-top:20px;margin-bottom:10px}.cell[_ngcontent-%COMP%]{display:flex;align-items:center;flex-direction:row;gap:5px}.sticky-header[_ngcontent-%COMP%]{position:sticky;top:0;background-color:#fff;z-index:1;padding:5px;font-size:20px;font-weight:700}.group-link[_ngcontent-%COMP%]{text-decoration:none;color:inherit;display:block;width:100%;padding:16px}.group-link[_ngcontent-%COMP%]:hover{color:#1976d2}.expense-table[_ngcontent-%COMP%]{width:100%;table-layout:fixed}.expense-table[_ngcontent-%COMP%]   .mat-column-description[_ngcontent-%COMP%]{flex:1;min-width:150px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.expense-table[_ngcontent-%COMP%]   .mat-column-amount[_ngcontent-%COMP%]{width:100px;text-align:right}.expense-table[_ngcontent-%COMP%]   .mat-column-date[_ngcontent-%COMP%]{width:120px}.expense-table[_ngcontent-%COMP%]   .mat-column-paid[_ngcontent-%COMP%]{width:80px;text-align:center}.expense-table[_ngcontent-%COMP%]   .mat-column-actions[_ngcontent-%COMP%]{width:140px;text-align:center}"]})};export{ce as MyExpensesComponent};
