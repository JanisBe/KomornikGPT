import{B as c,G as r,J as p,M as n,Tb as U,Zb as g,a as i,b as a,i as o,t as h,w as l}from"./chunk-OCIATHT5.js";var b={production:!1,apiUrl:"/api",oAuth:"http://localhost:8080/oauth2/authorization"};var v=class s{constructor(e,t){this.http=e;this.router=t;this.checkAuthStatus()}apiUrl=b.apiUrl;currentUserSubject=new o(null);authCheckInProgress=null;login(e){return this.http.post(`${this.apiUrl}/auth/login`,e,{withCredentials:!0}).pipe(r(t=>{this.currentUserSubject.next(t.user)}))}logout(){this.http.post(`${this.apiUrl}/auth/logout`,{},{withCredentials:!0,responseType:"text"}).subscribe({next:()=>{this.clearAuthState(),this.router.navigate(["/login"])},error:()=>{this.clearAuthState(),this.router.navigate(["/login"])}})}getCurrentUser(){return this.authCheckInProgress?this.authCheckInProgress:this.currentUserSubject.value?this.currentUserSubject.asObservable().pipe(h(e=>e!==null),l(1)):(this.authCheckInProgress=this.http.get(`${this.apiUrl}/auth/user`,{withCredentials:!0}).pipe(r({next:e=>{e&&e.authenticated?this.currentUserSubject.next(e):this.currentUserSubject.next(null)},error:()=>{this.currentUserSubject.next(null)},complete:()=>{this.authCheckInProgress=null}}),c(1)),this.authCheckInProgress)}updateProfile(e){return this.http.put(`${this.apiUrl}/users/me`,e,{withCredentials:!0}).pipe(r(t=>{let u=this.currentUserSubject.value;if(u){let d=a(i(i({},u),t),{expensesPaid:t.expensesPaid||[],splits:t.splits||[],groups:t.groups||[]});this.currentUserSubject.next(d)}}))}isAuthenticated(){return!!this.currentUserSubject.value}clearAuthState(){this.currentUserSubject.next(null)}getLoggedUser(){return this.currentUserSubject.value}checkAuthStatus(){this.getCurrentUser().subscribe({next:e=>{e.authenticated?(this.currentUserSubject.next(e),this.router.url==="/login"&&this.router.navigate(["/groups"])):this.currentUserSubject.next(null)},error:()=>{this.currentUserSubject.next(null)}})}static \u0275fac=function(t){return new(t||s)(n(U),n(g))};static \u0275prov=p({token:s,factory:s.\u0275fac,providedIn:"root"})};export{b as a,v as b};
